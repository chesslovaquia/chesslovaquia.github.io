{{- $buildID := getenv "HUGO_CLVQ_BUILD" | default "UNSET" -}}

{{- $cdn := .Site.Params.cdn -}}
{{- $js_load := .Site.Params.js_load }}
{{- $game_js := .Site.Params.game_js }}
{{- $sw_js := .Site.Params.sw_js }}

<!-- Game assets -->
{{- if eq .Params.gamePage "load" }}
  {{- $js_load = $js_load | append $game_js }}
{{- end }}

{{- range $resource := $js_load }}
  {{- with resources.Get $resource }}
    {{- if eq hugo.Environment "devel" }}
      {{- with . | js.Build }}
        <script src="{{ $cdn }}{{ .RelPermalink }}?v={{ $buildID }}"></script>
      {{- end }}
    {{- else }}
      {{- $opts := dict "minify" true }}
      {{- with . | js.Build $opts | fingerprint }}
        <script src="{{ $cdn }}{{ .RelPermalink }}?v={{ $buildID }}"
          integrity="{{- .Data.Integrity }}"
          crossorigin="anonymous"></script>
      {{- end }}
    {{- end }}
  {{- end }}
{{- end }}

<!-- PWA Service Worker -->
{{- $sw_js := resources.Get $sw_js | resources.ExecuteAsTemplate $sw_js . -}}
{{- $sw_js.Publish -}}
